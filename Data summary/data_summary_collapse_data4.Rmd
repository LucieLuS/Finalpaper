---
title: "First Draft of Final Paper"
author: "Lucie Lu"
date: "March 19, 2018"
geometry: margin=1.5in
output: pdf_document
---


Since the 1980s, economic liberalization has advanced remarkably. There has been a marked shift in the orientation of the trade and industrial policies for developing countries. Many developing countries moved away from a heavy reliance on direct intervention and inward-looking trade regimes toward less controlled and more export-oriented trade regimes. Simply put, they chose to liberalize their trade regimes. Many developing countries have decided to integrate their economies into a global economy by dismantling their protectionist trade policies. Countries such as Argentina, Brazil, Indonesia, Mexico have conducted substantial trade reforms respectively, including reducing tariff rates, reforming import licensing procedures in the 1980s. What drove such a substantial change in their trade policy? 



What has driven the trend in trade liberalization? For the developing countries, it is costly for them to abandon the protectionist, import-substituting industrialization strategy given that they have been the orthodoxy among developing country policymakers in the post-war period. A temporary protection for the infant industry is sometimes necessary for infant industries to gain competitiveness in trade in the developing countries. However, over time, many infant industries refuse to mature but become inefficient, and what is worse, they hold vested interests of the oligarchies. In this case, interest groups and political leaders usually benefit from the status quo of the protectionist policies. Change in the protectionist status quo is unexpected. This make the question puzzling. If the political leaders benefit from the status quo, why do they conduct reforms? Why would they choose to lower the trade barriers?


#Argument


Rodrick (1994) argues that it is very difficult for politicians to conduct liberalization reforms in normal times, but times of crises can provide an opportunity moment for undertaking structural reforms. What are the 'times of crises' to drive the structural change? Some scholars claim the economic crises may force countries to give up the protectionist old policies and move toward a market-friendly and open one. Crises may underscore the problems of the old protectionist view of a country, so countries conduct reform and liberalize to recover from the crises (Krugers, 1997). Others claim that external pressure such as a country's accession to the international institutions helps facilitate the transition. External pressures such as the World Trade Organization (WTO), IMF or trade treaties, matter (Vreeland, 2007). When developing countries join these international institutions or sign the binding international trade agreements with other developed countries, the newly joined members will show their commitment to the international regimes (Baccini & Urpelainen, 2014). A voluntary tariff reduction in a developing country will send a promising signal to the international community. 


Now, what about political reforms?  Another closely related structural change, the trend of democratization, was happening a decade before the trend to free trade. In 1975, there were around thirty democracies in the world, while by 1992, there were about eight-nine. Are these two trends causally related or happened to coincide by chance? When countries are more democratized, are they more likely to initiate trade liberalizing economic reforms? Are sharp changes in the economic reform the product of political transformation? As Rodrik argued, "Not all political transformations result in trade reform, but sharp changes in trade policy are typically the result of such transformation (1994, p. 69)." This article largely focuses on the regime type. To show that the regime type places a role in the move to free trade, I will also control for the factors of economic crisis and external pressure illustrated above.  



What remains unclear is whether political reforms affect trade policy reforms, or whether trade reforms induce political transition. The research design of observational data plus classic regression model cannot fully address this endogeneity issue. The fundamental problem of drawing causal inference in an observational data is to make the right comparison. To compare apples to apples, we need to hold other things equal. Because in observational studies, treatments are observed rather than assigned, so it is not possible to consider the observed data under different treatment are randomly assigned. It is highly possible that the two groups of countries (one with democratization, the other without) are fundamentally different in many ways. All of the potential confounders (whether observed or unobserved) will obscure the causal relationship we try to infer. Milner and Kubota's article (2005), "Why the Move to Free Trade? Democracy and Trade Policy in Developing Countries" is a classic piece. They provide a systematic investigation on the relationship between regime change and trade liberalization. They have suggested that democracy has led to trade liberalization. I will cast doubt on their analysis strategy that has relied on controlling for confounding covariates through linear regression. I suggest that a more sophisticated research design, matching can to some extent solve the selection bias problem in the observational data.  


I am going to replicate and extend the paper on Milner and Kubota's argument: When countries become more democratic, they are more willing to open their markets to the international economy. I have a couple of concerns on their original work. They present the average treatment effect of democracy on average tariff level in the Ordinary Least Squares (OLS) model, which at best only presents the two variables are positively correlated. Given the limitation of observational data, it is not convincing to draw a causal relationship between the two. To extend their original piece, inspired by Angrist and Pischke (2015), I will conduct a regression with matching approach to overcome the possible selection problem in the observational data. The goal of this replication paper is to present a regression-based causal story: countries that have democratized will tend to lower their levels of trade barriers.  


The paper will be divided into three main sections. The first section will briefly describe the variables, measures, the reasons for adjustment. The second and third section present discussion of two methods of statistical inference and assessment.   



```{r global_options, include=FALSE, cache=FALSE}
## To make the pdf file do
## render("exploration4.Rmd",output_format=pdf_document())

require(knitr)
opts_chunk$set(
  tidy=FALSE,     # display code as typed
  size="small",    # slightly smaller font for code
  echo=TRUE,
  results='markup',
  strip.white=TRUE,
  fig.path='figs/fig',
  cache=FALSE,
  highlight=TRUE,
  width.cutoff=132,
  size='footnotesize',
  out.width='.9\\textwidth',
  message=FALSE,
  comment=NA)

```


```{r initialize,echo=FALSE, message=FALSE, warning=FALSE}
##First, just setup the R environment for today:
if(!file.exists('figs')) dir.create('figs')

options(SweaveHooks=list(fig=function(){
			   par(mar=c(3.5, 3, 1.1, 0),
			       pty="s",
			       mgp=c(1.5,0.5,0),
			       oma=c(0,0,0,0))},
			 echo=function(){options(continue=" ") ##Don't show "+" prompts,
			 options(prompt=" ")
			 }),
	digits=4,
	scipen=8,
	width=132
	)
options(error=function(){options(prompt="> ",continue="+ ");NULL})

getwd()

#To prepare the environment
library(readstata13)
library(dplyr)
library(ggplot2)
#install.packages("ggrepel")
library(ggrepel)
library(stargazer)

#install.packages("devtools")
library(devtools)

library(foreign)
#install.packages("gplots")
library(gplots)

library(lmtest)
library(sandwich)

library(tidyverse)

library(MASS)
library(robustbase)

#install.packages("rmngb")
library(rmngb)
```

```{r set up the data, echo=FALSE, message=FALSE, warning=FALSE, include=F}
getwd()
library("here")
set_here(path=".", verbose=T)
here()

list.files(path=".")
load("mydata_2fulldataset.rda")
load("mydata_5collapseyear.rda")

```

#Section I: Data on Trade Liberalization and Democratization

The data that I use in the following analysis is a data set compiled by Milner and Kubota (2005). It is a time-series cross-sectional (TSCS) data, covering 81 developing countries from 1980 to 1999. It include various measures not only on trade policy but also of a series of political regime measures, economic development measures and so on. The central hypothesis is that an increase in democracy will lead to a reduction in trade barriers, ceteris paribus.    


The data Milner and Kubota have collected on the developing countries demonstrate a significant change in the measure of trade policy. *Tariff*, a country's unweighted average statutory tariff rate collected, is a key measure of a country's trade policy in year *t*. The historical trend shows that a dramatic decline in the average tariff level across countries has happened from 1982 to 1999. Statutory tariff rate has decreased by over sixty percent, from an average about 30 percent in 1980 to around 12 percent in 1999 in the developing countries.

```{r, eval=T, echo=F, results="hide"}
#library(readstata13)
mydata <- read.dta13(file.choose())
#View(mydata)
#Subset the large dataset
mydata2 <- mydata[,c(2,3,14,7,15,5,40,17,4,8,10,16), drop=F]


#View(mydata2)
colnames(mydata2) <- c("Country","Year","Tariff","Openness","Regime","Democracy","Dictator","Years of Office","GATT/WTO","Economic Crisis","GDP PC 95","IMF")
mydata_2 <- subset(mydata2, Year > 1979) #Select the years aftr 1979.

save(mydata_2,file="mydata_2fulldataset.rda")

#The change of the statutory tariff rate
m1980 <- mean(mydata2$Tariff[mydata2$Year==1980], na.rm = T)
m1999 <- mean(mydata2$Tariff[mydata2$Year==1999], na.rm = T)
mperc<- (m1999-m1980)/m1980
mperc #-0.58

result_m_tariff <- data.frame(matrix(nrow=20, ncol=2))
colnames(result_m_tariff) <- c ("Year", "Tariff")
for (i in 1:20){
  result_m_tariff[i,1] <- i+1979
  mean <- mean(mydata2$Tariff[mydata_2$Year== i+1979], na.rm = T)
  result_m_tariff[i,2] <- mean
}
result_m_tariff
#plot(result_m_tariff)

```


More evidence of trade liberalization comes from a second measure of trade policy: the dichotomous categorization of countries into open and closed trade regimes. The data covers ninety developing countries from 1980 to 1999. In 1980, only 14 countries were scored as openness, while in 1999, 62 countries were open economies. The number of a country classified as open economy has increased by three times.

```{r, eval=T, echo=F, results="hide"}
o1980 <- sum(mydata2$Openness[mydata2$Year==1980 & mydata2$Openness == 1], na.rm = T) #14
o1999 <- sum(mydata2$Openness[mydata2$Year==1999 & mydata2$Openness == 1], na.rm = T) #62
operc <- (o1999-o1980)/o1980

```

Evidence of democratization among the developing countries is also plentiful. To measure regime type, the paper uses the 21-Point Polity Score, ranging from -10 for a highly autocratic state to 10 for a highly democratic state. The average Polity IV score for about 110 developing countries that fell from around -3.4 to -4.7 and increased sharply to a score of 1.8 in 1999. It suggests that although many regimes on averages with mixes of democratic and autocratic features (-5 to 5), the wave of democratization has been evident since the mid-1970s. Similarly, the dichotomous regime shows how the number of democracies has increased over time. The series show that the process of democratization has started in the 1970s. In 1970, less than 20 developing countries were quantified as democracies. Over three decades, there has been a four-fold increase in the number of democracies among the developing countries.  

```{r, eval=T, echo=F, results="hide"}

result_m_regime_2 <- data.frame(matrix(nrow=30, ncol=2))
colnames(result_m_regime_2) <- c ("Year", "PolityScore")
for (i in 1:30){
  result_m_regime_2[i,1] <- i+1969
  mean <- mean(mydata2$Regime[mydata2$Year== i+1969], na.rm = T)
  result_m_regime_2[i,2] <- mean
}
result_m_regime_2

#plot(result_m_regime_2)

```

```{r, eval=T, echo=F, results="hide"}

result_m_regime_3 <- data.frame(matrix(nrow=30, ncol=2))
colnames(result_m_regime_3) <- c("Year", "Democracy")

for (i in 1:30){
  result_m_regime_3[i,1] <- i+1969
  counter <- sum (mydata2$Democracy[mydata2$Year== i+1969 & mydata2$Democracy ==1], na.rm=T)
  result_m_regime_3[i,2] <- counter
}

result_m_regime_3

#plot(result_m_regime_3)
```



#Section II: Empirical analysis: The OLS Models

##Variables and Measures


**Dependent Variables**  
*Tariff* is a country's average statutory tariff rate between 1980 and 1999. However, this is poorly measured with a large number of missing data in the dataset. To be fair, it is notoriously difficult to measure and hard to find time-series and cross-sectional data on this measure.  


**Independent Variable**

*Regime (Polity Score)* is a 21-point scale that measures variations both within democracies and among autocracies. This measurement comes from Polity III and Polity IV. It ranges from -10 (highly autocratic) to 10 (highly democratic). I converted it as a dichotomous variable *Democracy* with countries scoring below 6 in the Polity Score as autocracies (=0) and those above 6 as democracies (=1). The hypothetical treatment here is "*democracy*." 



**Control Variables and Justification**  


*GDP per capita* is a lagged value of per capita real GDP based in 2005. The economic development is likely to affect its trade policy and its political regime change. More developed countries tend to be more economically and politically liberal. More developed countries tend to have smaller trade barriers.  


*Economic Crisis* is an extreme event that occurs in that specific year rather than an economic variable with yearly change. To code that year with the economic crisis, one of the two conditions hold: either the country's inflation rate is 40 percent or more, and it increases by 25 percent or more from the year before, or per capita GDP falls by 15 percent or more from the previous year (=1).     

When countries experience crisis, the political leaders tend to conduct political and economic reforms to address the crisis. They are more likely to liberalize their trade regime because of a domestic demand or conditionality of foreign aid. They will tend to lower the tariff rates to facilitate trade. Under the pressure of economic crisis, politicians are more likely to undergo political reforms as well.   

*GATT/WTO Member* is A lagged variable indicating whether a country is in the GATT/WTO(=1) or not. Joining a WTO induce member countries to lower their trade barriers. Also, WTO members tend to welcome new members intending to adopt liberal policies in both economic and political domains. Therefore, this controlled variable may have effects on both independent and dependent variables.  


*Years of Office* counts the number of years a government has been in office. It ranges from 0 to 44, with the mean of 8.4. It is included in the control variable because the number of years a government in power will have an impact on both political and economic reforms. A new government might indicate a change in leadership and new idea.


The summary of statistics is included in the appendix.



```{r, eval = TRUE, echo = FALSE, results = "hide", message = FALSE, warning = FALSE}
#summary(mydata_2)
#str(mydata_2)
#dim(mydata_2)

#########Explore the data
#Check the missing values
#table(mydata_2$Tariff, useNA="ifany") #The missing values: NA = 2683
sum(mydata_2$Tariff == "  ", na.rm=T) #if there is any missing valus in the blank
sum(mydata_2$Tariff == "0", na.rm=T) #20
is.na(mydata_2)[1,] #From this, we can see only the variable "Tariff" has missing values

#Check the missing values of Tariff before 1980 
mydata2_3<- subset(mydata2, Year <= 1979)
#table(mydata2_3$Tariff, useNA="ifany") #The missing values: NA = 2683

#desribe the data
library(psych)
#subset the data without country name
mydata_2_des_noc <- mydata_2[,!names(mydata_2)%in%c("Country")]
#basic descriptive Statistics
data2_des <- describe(mydata_2_des_noc, na.rm=T, check=T, skew=F, quant=c(.25,.5,.75))
data2_des

```

```{r Table data description, results='asis', echo = FALSE, message=FALSE, include=F}
#install.packages("stargazer") If you haven't already installed. Install stargazer.
library(stargazer)
#Now use stargazer to format the linear model
stargazer(mydata_2_des_noc, header = FALSE, iqr=T,
          title = "Summary Statistics", digits = 1, out = "table1.txt",
          no.space = TRUE, font.size = "footnotesize")
```





```{r Checking missing values, results='asis', echo = FALSE, message=FALSE, include=F}

#table(mydata_2$Tariff, useNA="ifany") #The missing values from 1980 t0 1999: NA = 2683
sum(mydata_2$Tariff == "  ", na.rm=T) #if there is any missing valus in the blank
sum(mydata_2$Tariff, na.rm=T)
2683/18628

is.na(mydata_2)[1,] #From this, we can see only the variable "Tariff" has missing values

##---

mydata2_3<- subset(mydata2, Year <= 1979) #before 1979
table(mydata2_3$Tariff, useNA="ifany") #The missing values: NA = 1780

table(mydata2$Openness, useNA="ifany") #The missing values of openness: NA = 2580
```
```{r prepare a lagged dataset mydata3, eval=T, echo=F, results="hide", warning=F} 
mydata3 <- mydata[,c(2,3,14,7,31,11,41,28,49,13,21,34), drop=F]
colnames(mydata3) <- c("Country","Year","Tariff","Openness","Regime(t-1)","Democracy(t-1)","Dictator(t-1)","Years of Office(t-1)",
                       "GATT/WTO(t-1)","Economic Crisis(t-1)","GDP PC 95(t-1)","IMF(t-1)")

save(mydata3,file="mydata3_fulldatasetlagged1year.rda")

Regime_l1 <- mydata3[,"Regime(t-1)"]
WTO_l1 <- mydata3[,"GATT/WTO(t-1)"]
YO_l1 <- mydata3[,"Years of Office(t-1)"]
EC_l1 <- mydata3[,"Economic Crisis(t-1)"]
IMF_l1 <- mydata3[,"IMF(t-1)"]
GDP_l1 <- mydata3[,"GDP PC 95(t-1)"]
lnGDP_l1 <- log(mydata3[,"GDP PC 95(t-1)"])
```

```{r prepare a small dataset mydata4, eval=T, echo=F, results="hide", warning=F} 

mydata4 <- mydata3
Regime_l1 <- mydata3[,"Regime(t-1)"]

## Recode this variable into 1= "democracy (polity score is 6 or more) or more" versus 0="non-democracy (polity score is 6 or less)'' category:
mydata4 <- mutate(mydata3, Regime_l1_Bi = 1*(Regime_l1 >= 6))
#Check the recoding
with(mydata4, table(Regime_l1_Bi, Regime_l1,useNA="ifany"))
#I turned Polity's Regime variable into a dichotomous variable with countries scoring below 6 as autocracies and those above 6 as democracies (=1).

save(mydata4,file="mydata4.rda")

###########
row.has.na <- apply(mydata4, 1, function(x){any(is.na(x))})
sum(row.has.na)

mydata4_small <- mydata4[!row.has.na,]
summary(mydata4_small)
nrow(mydata4)#5370
nrow(mydata4_small)#662

Regime_l1_Bi_s <- mydata4_small$Regime_l1_Bi
GDP_l1_s <- mydata4_small$`GDP PC 95(t-1)`
EC_l1_s <- mydata4_small$`Economic Crisis(t-1)`
WTO_l1_s <- mydata4_small$`GATT/WTO(t-1)`
YO_l1_s <- mydata4_small$`Years of Office(t-1)`

save(mydata4_small,file="mydata4_NAremoved.rda")

```

```{r try collapsing data, results='hide', echo = FALSE, message = FALSE, warning=FALSE, include=F}

#getwd()
#list.files()
load(file="C:/Users/Lucie Lu/Documents/531-explorations/Finalpaper/Data/mydata4_NAremoved.rda")


mydata_5 <- mydata4_small %>%
  group_by(Country) %>%
  summarize(Tariff_c = mean(Tariff),
            Regime_c = mean(`Regime(t-1)`),
            YearOffice_c = mean(`Years of Office(t-1)`),
            WTO_c = mean(`GATT/WTO(t-1)`),
          EC_c = mean(`Economic Crisis(t-1)`),
          GDP_c = mean(`GDP PC 95(t-1)`),
          IMF_c = mean(`IMF(t-1)`))


#the number of observations in each cluster
mydata4_small %>%
  group_by(Country) %>%
  summarize(no_obs=n())

mydata_5 <- mutate(mydata_5, Regime_Bi_c = 1*(Regime_c >= 6))
mydata_5$countryF<-factor(mydata_5$Country) 

save(mydata_5,file="mydata_5collapseyear.rda")

```



##Data Structure

The correlation coefficient itself is simply a way to describe how the two variables vary together. Here, I first look at the bivariate relationship between the average tariff rate and polity score. The correlation coefficient *r* is -0.12. From Table 2, we can see there are negative relationships between the dependent variable, the independent variable and the control variables (except WTO members). It is noted that the covariate coefficients between the dependent variable, independent variable and cofounders are low. This correlation matrix provides evidence of a low possibility of the collinearity issues in the later regression analysis.  

```{r bivariate relationship, eval = TRUE, echo = FALSE, results = "hide", message = FALSE, warning = FALSE}

plot (mydata2$Regime, mydata2$Tariff, col = "darkblue", pch = 20, xlab = "Regime Type (Polity Score)", ylab = "Tariff Rate (in percentage)",
      main = "Bivariate Relationship bewtween \n Regime Type and Tariff Rate")

OLS_1 <- lm(Tariff ~ Regime, data=mydata2)
abline(OLS_1)

r_tr <- cor(mydata2$Tariff, mydata2$Regime, use = "pairwise.complete.obs")

rr <- mydata2$Regime[!is.na(mydata2$Regime)]
rt <- mydata2$Tariff[!is.na(mydata2$Tariff)]

text(quantile(rr, .95), quantile(rt, .99), paste("r=",round(r_tr,2)), font=2)
```

```{r bivariate relationship2, eval = TRUE, echo = FALSE, results = "hide", message = FALSE}
Regime <- mydata2$Regime
Tariff <- mydata2$Tariff
lnGDP <- log(mydata2[,"GDP PC 95"])
EC <- mydata2[,"Economic Crisis"]
WTO <- mydata2[,"GATT/WTO"]
YO <- mydata2[,"Years of Office"]

matrix_cor <- data.frame(Tariff, Regime, lnGDP, EC, WTO, YO)
#as.matrix(matrix_cor)

rcor<-cor(matrix_cor,use="pairwise.complete.obs")
for(i in 1:6){
  for(j in 1:6){
    if(j<i){rcor[i,j] <- NA}
}}
round(rcor,2)
```

```{r xtable bivariate relationship, eval = TRUE, echo = FALSE, results='hide', message = FALSE, warning = FALSE, include=FALSE}

#install.packages("xtable",repos = "http://cran.us.r-project.org")
library(xtable)
names <- c("Tariff rate", "Regime (Polity Score)", "GDP per capita (log)", "Economic Crisis", "GATT/WTO Member", "Years of Office") 
rownames(rcor) <- names
TAB1<-round(rcor,2)
xtable(TAB1)
```

```{r print xtable bivariate relationship, eval = TRUE, echo = FALSE, results='asis', message = FALSE, warning = FALSE}

print(xtable::xtable(rcor, caption = "Correlation Matirx: Correlations among Variables and Confounders"),type = "latex",
      html.table.attributes="border=1")
```


This figure tells me two important problems of the data structure in this dataset: 1) There are outliers in the data structure that we need to take them into account. Later on, I will use "lmrob" regression modelling strategy to handle unusual observations that do not follow the general trend of the dataset. 2) Variations of tariffs and polity scores across countries and across years are merged. For a single point on the figure, I can get the values of x (polity score) and y (tariff rate) of that point. However, I do not know that particular point stands for which year or/and which country. Before I proceed, I will examine whether variation across countries for a given year (*country differences*) or variation across years within a given country (*year differences*)is higher.
      
```{r justify why I collapse data by years, results='hide', echo = FALSE, message = FALSE, warning=FALSE, include=F}
mydata4_small$countryF<-factor(mydata4_small$Country) 

countryMeans<-with(mydata4_small,tapply(Tariff,countryF,mean)) 
countrydiff<-var(countryMeans)
yeardiff<-mean(with(mydata4_small,tapply(Tariff,countryF,var)), na.rm = T)
#This code gives the mean of within-country (grouped by countryF) variance

#Across-country variance is around 1.7 times of the within-country-years variance. It means that differences across countries are higher than differences across years within each country.
countrydiff #123.7
yeardiff #70.71

#Interclass correlation (Gilman & Hill, p. 258): the relative values of country- and year-level variances variances. In this case, the interclass correlation 0.63 suggests that differences acorss countries convey more information than differences across years within a country. 
yeardiff/(countrydiff+yeardiff) #0.36
countrydiff/(countrydiff+yeardiff) #0.63

#install.packages("ICC")
library(ICC)
ICC_wc <- ICCbare(y=Tariff,x=countryF,data=mydata4_small) 
ICC_wc #0.63

# It is a method of Simple Estimation of the Intraclass Correlation Coefficient. The ICC score describes how strongly units in the same group resemble each other.
# High intraclass correlation means values(y) from the same group tend to be similar. The variance within countries is quite high with ICC score 0.63. This suggests that within a country, a country's tariff levels have not changed much across years.

```

```{r  ggboxplot for cross country variations, eval = TRUE, echo = FALSE, results = "hide", message = FALSE}

## to visualize variances accross countries

plotCF <- ggplot(mydata4_small, aes(x=countryF, y=Tariff)) + geom_boxplot()  

plotCF + theme_classic() +ggtitle("Tariff variations across countries") + theme(
        plot.title = element_text(hjust = 0.5),
        axis.title.x=element_blank(),
        axis.text.x=element_blank(),
        axis.ticks.x=element_blank()) + labs (X = "Country", y= "Tariff Rates (in percentage)")
```

```{r  ggboxplot for cross year variations, eval = TRUE, echo = FALSE, results = "hide", message = FALSE}
## to visualize variances accross years

Year.factor <- factor(mydata4_small$Year)
plotyears <- ggplot(mydata4_small, aes(x=Year.factor, y=Tariff)) + geom_boxplot() 

plotyears + 
  theme_classic() +
  ggtitle("Tariff variations across Years") + 
  theme(plot.title = element_text(hjust = 0.5)) +
 labs (X = "Year", y= "Tariff Rates (in percentage)")
```

I calculated across-country variance (`r countrydiff`) and within-country-years variance (`r yeardiff`). Across-country variance is around 1.7 times of the within-country-years variance. It means that differences across countries are higher than differences across years within each country. I also calculated an ICC score: It is a method of Simple Estimation of the Intraclass Correlation Coefficient. Interclass correlation is the relative values of the country- and year-level variances (Gilman & Hill, p. 258). The variance within countries is quite high with ICC score `r ICC_wc`. In this case, the interclass correlation `r ICC_wc` suggests that differences between across countries convey more information than differences across years within a country. This suggests that within a country, a country's tariff levels have not changed much across years. In contrast, tariffs variations across countries are high. The boxplots further demonstrate this point. 


In the current dataset, the panel dataset includes the yearly tariff data for 81 developing countries over a 20-year period. Tariffs variations across countries are larger than variations across years within a country. Therefore, I collapse the dataset to 81 data points so I can know what the mean tariff rate (and other information) is for each country. Here, the country is the grouping variable. 


Hence, I reduce the data to the cross-sectional dimension. I run my analysis based on time-series averages. My dependent variable is the time-series mean of tariff rate of the country *i* and my independent variable is the time-series mean of polity score. I also converted the time-series mean of polity score to a dichotomous variable, meaning that a developing country is democratic or non-democratic based on the polity scores on average over the 20-year period.  
 

```{r bivaraite relationship in dataset5, eval = TRUE, echo = FALSE, results = "axix", message = FALSE}


plot_bi5 <- ggplot(mydata_5, aes(x= Regime_c, y = Tariff_c, label=countryF)) + geom_point() 

### geom_label_repel

plot_bi5 + 
  geom_text_repel(data = filter(mydata_5, (Regime_c < -3 & Tariff_c >30) | (Regime_c > 6 & Tariff_c < 15) | Tariff_c > 40)) +
  theme_classic() +
  ggtitle("Bivariate Relationship bewtween \n Regime Type and Tariff Rate (with Country Labels)") + 
  theme(plot.title = element_text(hjust = 0.5)) +
  labs (x = "Regime Type (Polity Score)", 
        y= "Tariff Rate (in percentage)")

```

##Hypothesis


I have laid out the reasons to control for the three covariates: GDP per capita, economic crisis and WTO membership. The fourth one, "year of office"" is added for additional check. Only covariates that meet the condition of affecting both the treatment and outcome variables confound the observed relationship between the two (Rubin, 1997; Achen, 1982). I hope that through the control of these relevant covariates, the treatment effect of democratization is less cofounded. I lag all of the independent variables by one year. The basic OLS equation estimating the relationship between democracy and trade policy is:  

$tradepolicy_{i,t} = \beta_0 + \beta_1*Democracy_{i,t-1} + \beta_2*GDPPC_{i,t-1} + \beta_3*ECCRISIS_{i,t-1} + \beta_4*WTO_{i,t-1} + \beta_5*OFFICE_{i,t-1} + \varepsilon_i$  


My main hypothesis is *democratic developing countries are oriented toward lower tariff rates than nondemocratic developing countries.*


I compare democratic developing countries and non-democratic developing countries in this model. The regime type, "democracy" is a hypothetical treatment effect. I concern what would happen to the average tariff rate of a given developing country as a result of a hypothesized "treatment (democracy)" in the observational studies. I understand this is not a randomized experiment at all, and the treatment and control groups in nature are not similar. I hope that I can to some extent address this problem through proper modelling and statistical adjustment.   


Table 2 shows that compared to non-democratic countries, democratic countries on average tend to have lower tariff rates. In all of the regressions, the estimators of *democracy* have expected negative signs that support my main hypothesis. In equation (6), the main model here with three covariates, we know that the average tariff rates fall by 2 percent if a country changes from non-democracy to a democracy.    


```{r OLS2 binary, results='hide', echo = FALSE, message = FALSE, warning=FALSE, include=F }
#comparing democracy and non-democracy
OLS_5_0Bs <- lm(Tariff_c ~ Regime_Bi_c, data=mydata_5)
summary(OLS_5_0Bs)$coefficient #-4.287 

OLS_5_1Bs <- lm(Tariff_c ~ Regime_Bi_c + log(GDP_c), data=mydata_5)
summary(OLS_5_1Bs)$coefficient # -1.748 

OLS_5_2Bs <- lm(Tariff_c ~ Regime_Bi_c + log(GDP_c) + EC_c, data=mydata_5)
summary(OLS_5_2Bs)$coefficient #-1.83 

OLS_5_3Bs <- lm(Tariff_c ~ Regime_Bi_c + log(GDP_c) + WTO_c, data=mydata_5)
summary(OLS_5_3Bs)$coefficient #-1.89

OLS_5_4Bs <- lm(Tariff_c ~ Regime_Bi_c + log(GDP_c) + YearOffice_c, data=mydata_5)
summary(OLS_5_4Bs)$coefficient #-2

OLS_5_5Bs <- lm(Tariff_c ~ Regime_Bi_c + log(GDP_c) + EC_c + WTO_c, data=mydata_5)
summary(OLS_5_5Bs)$coefficient # -2
```


```{r myregression OLS2 Table, results='asis', echo = FALSE, message = FALSE, warning=FALSE}

library(stargazer)
stargazer(OLS_5_0Bs, OLS_5_1Bs, OLS_5_2Bs, OLS_5_3Bs, OLS_5_4Bs, OLS_5_5Bs, header = FALSE, df = FALSE,
          title = "Multiple Linear Regression Model: Results",
          covariate.labels = c("Democracy", "GDP per capita", "Economic Crisis", "GATT/WTO Member", "Years of Office"),
          dep.var.labels = "Tariff Rates", 
          column.sep.width = "0.3pt", no.space = TRUE, font.size = "footnotesize")
```


In regression modelling, lmrob is a robust statistics, which could be considered to handle unusual observations and outliers that do not follow the general trend of the data set. 'Robust' means that the tests have good power for a wide variety of distributions even if some of the assumptions used to justify the estimation method are not applicable. The *lmrob* output from the *lmrob* function provides 'robustness weights' to give us information about the outliers in the observations by evaluating their weights and summarize statistics from the remaining observations. It uses a fitting criterion that is not as vulnerable as least squares to unusual data. The estimators in the *lmrob* robust regression are weighted-least-squares estimates.  


In all the models, the estimators' signs are negative, as expected. Compared to the lm models, the magnitudes of the treatment effects are higher. In equation (6), we can see that the average tariff rates fall by 3.5 percent if a country changes from non-democracy to a democracy. The estimators for GDP per capita and economic crisis also have the expected negative signs. 

```{r lmrob2, results='hide', echo = FALSE, message = FALSE, warning=FALSE, include=F}

set.seed(2000814)

#3 observations are outliers
lmrob_5_0Bs <- lmrob(Tariff_c ~ Regime_Bi_c, data=mydata_5, control = lmrob.control(max.it = 100))
summary(lmrob_5_0Bs)$coefficient #-4.58

lmrob_5_1Bs <- lmrob(Tariff_c ~ Regime_Bi_c + log(GDP_c), data=mydata_5, control = lmrob.control(max.it = 100))
summary(lmrob_5_1Bs)$coefficient #-3.18

lmrob_5_2Bs <- lmrob(Tariff_c ~ Regime_Bi_c + log(GDP_c) + EC_c, data=mydata_5, control = lmrob.control(max.it = 100))
summary(lmrob_5_2Bs)$coefficient #-3.27

lmrob_5_3Bs <- lmrob(Tariff_c ~ Regime_Bi_c + log(GDP_c) + WTO_c, data=mydata_5, control = lmrob.control(max.it = 100))
summary(lmrob_5_3Bs)$coefficient #-3.20

lmrob_5_4Bs <- lmrob(Tariff_c ~ Regime_Bi_c + log(GDP_c) + YearOffice_c, data=mydata_5, control = lmrob.control(max.it = 100))
summary(lmrob_5_4Bs)$coefficient #-2.50

lmrob_5_5Bs <- lmrob(Tariff_c ~ Regime_Bi_c + log(GDP_c) + EC_c + WTO_c, data=mydata_5, control = lmrob.control(max.it = 100))
summary(lmrob_5_5Bs)$coefficient #-3.3

```

```{r myregression lmrob Table 2, results='asis', echo = FALSE, message = FALSE, warning=FALSE}

library(stargazer)
stargazer(lmrob_5_0Bs, lmrob_5_1Bs, lmrob_5_2Bs, lmrob_5_3Bs, lmrob_5_4Bs, lmrob_5_5Bs, header = FALSE, df = FALSE,
          title = "Multiple Linear Regression Model (lmrobust): Results",
          covariate.labels = c("Democracy", "GDP per capita", "Economic Crisis", "GATT/WTO Member", "Years of Office"),
          dep.var.labels = "Tariff Rates", 
          column.sep.width = "0.3pt", no.space = TRUE, font.size = "footnotesize")
```

What assumptions do we have about the unmeasured forces influencing the outcome variables? In the linear regression, we assume linearity as a function form of the measured regressors and the dependent variable. However, all it requires is the independent variables should not be *perfectly* collinear (Achen, 1982). According to Achen (1982), if these assumptions are met, the coefficient estimates from the OLS are consistent, meaning they will be very near to their true value in a large sample almost all the time. In other words, in general conditions, regression will produce fairly accurate estimates if we set up the model correctly. Great resilience is a strength of ordinary linear regression (Achen, 1982). That is probably why we should analyze our data with this powerful tool in the first place.  


```{r residual diagnostic plots 1 on non-linearity assumption, eval=T, echo=F, results="asis", message=F} 

#Residual plot

g_re <- ggplot(data.frame(x=mydata_5$Regime_Bi_c, y=resid(OLS_5_1Bs))
               , aes(x=x, y=y))
g_re <- g_re + geom_hline(yintercept=0, size=1)
#g_re <- g_re + geom_point(size=5, colour="black", alpha=0.4)
g_re <- g_re + geom_point(size=3, colour="orange", alpha=0.4)
g_re <- g_re + xlab("Regime Type") + ylab("Residual Tariff (precent)")
g_re + theme_classic()
```

```{r residual diagnostic plots 2 on non-linearity assumption, eval=T, echo=F, results="asis", message=F}
OLS_5_1Bs <- lm(Tariff_c ~ Regime_Bi_c + log(GDP_c), data=mydata_5)
OLS_5_1Bsyres <- resid(OLS_5_1Bs)
OLS_5_1x1x2res <- resid(lm(Regime_Bi_c ~ log(GDP_c),data=mydata_5))
OLS_5_1yx2res <- resid(lm(Tariff_c ~ log(GDP_c),data=mydata_5))

plot(OLS_5_1x1x2res, OLS_5_1yx2res, frame = FALSE, col = "black", bg = "lightblue", pch = 21, cex = 2, xlim = c(-2, 2), xlab = "residlm(x1~x2)", ylab = "residlm(y~x2)")
abline(lm(I(OLS_5_1x1x2res) ~ I(OLS_5_1yx2res)), lwd = 2)

```

I use the residual plot to check the linearity assumption. Residuals are the vertical distance between the outcomes and the fitted regression line. It is difficult to see its pattern when the independent variable is a binary one. However, linearity is satisfied because the independent variable only has two possibilities (0 or 1). Therefore, the estimator here is the differences of means between the treated and controlled group.     

I am concerned about the partial relationship between tariff rate and democracy score. I am interested in seeing what percent of the variation in the full multiple regression model (Model 2 in Table 2) cannot be explained by the independent variable but can be explained by the rest of the confounders. It is easier to show the partial relationship when I only have one independent variable and one control variable so I can remove one of them at a time. In this plot, I can see by removing one my covariate, "log(GDP_c)", there is still residual variability left after accounting for it. After removing the linear relationships between the potential confounder and both the explanatory and the outcome, the residual plot shows there is still a linear relationship between tariff rates and regime type. 

```{r, results='asis', echo=FALSE}
cat("\\newpage")
```

Appendix:

```{r Table data description 2, results='asis', echo = FALSE, message=FALSE}
#install.packages("stargazer") If you haven't already installed. Install stargazer.
library(stargazer)
#Now use stargazer to format the linear model
stargazer(mydata_2_des_noc, header = FALSE, iqr=T,
          title = "Summary Statistics", digits = 1, out = "table1.txt",
          no.space = TRUE, font.size = "footnotesize")
```




```{r code=readLines(knitr::purl('~/path/to/file.Rmd', documentation = 0)), eval = FALSE}

```








